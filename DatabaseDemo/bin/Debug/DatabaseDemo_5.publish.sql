/*
Deployment script for PlatformDemoDb

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "PlatformDemoDb"
:setvar DefaultFilePrefix "PlatformDemoDb"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL15.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL15.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Creating Procedure [dbo].[spTeam_Insert]...';


GO
CREATE PROCEDURE [dbo].[spTeam_Insert]
    @TeamId nvarchar(50),
    @ContactPhone int,
    @DateOfRegistration date,
    @IsInTop5 bit,
    @Lost int,
    @PasswordHash nvarchar(50),
    @Player1 nvarchar(50),
    @Player2 nvarchar(50),
    @Player3 nvarchar(50),
    @Player4 nvarchar(50),
    @TeamName nvarchar(50),
    @Wins int
AS
begin
  insert into dbo.[tblTeam] (ContactPhone, DateOfRegistration, IsInTop5, Lost,PasswordHash,Player1,Player2,Player3,Player4,TeamId,TeamName,Wins)
  values (@ContactPhone, @DateOfRegistration, @IsInTop5, @Lost, @PasswordHash, @Player1, @Player2, @Player3,@Player4, @TeamId,@TeamName,@Wins);
end
GO
PRINT N'Creating Procedure [dbo].[spTeam_Update]...';


GO
CREATE PROCEDURE [dbo].[spTeam_Update]
	@TeamId nvarchar(50),
    @ContactPhone int,
    @DateOfRegistration date,
    @IsInTop5 bit,
    @Lost int,
    @PasswordHash nvarchar(50),
    @Player1 nvarchar(50),
    @Player2 nvarchar(50),
    @Player3 nvarchar(50),
    @Player4 nvarchar(50),
    @TeamName nvarchar(50),
    @Wins int
AS
begin
   update dbo.[tblTeam]
   set TeamId = @TeamId, ContactPhone = @ContactPhone, DateOfRegistration = @DateOfRegistration, IsInTop5 = @IsInTop5,
   Lost = @Lost, PasswordHash = @PasswordHash , Player1 = @Player1, Player2 = @Player2, Player3 = @Player3, Player4 = @Player4,
   TeamName = @TeamName, Wins = @Wins
   where TeamId = @TeamId;
end
GO
PRINT N'Creating Procedure [dbo].[spTeaminChallenge_Delete]...';


GO
CREATE PROCEDURE [dbo].[spTeaminChallenge_Delete]
	@ChallengeId nvarchar(50)
AS
begin
	delete
	from dbo.[tblTeamInChallenge]
	where ChallengeId = @ChallengeId
end
GO
PRINT N'Creating Procedure [dbo].[spTeamInChallenge_Insert]...';


GO
CREATE PROCEDURE [dbo].[spTeamInChallenge_Insert]
	@ChallengedTeamId nvarchar(50),
	@ChallengerTeamId nvarchar(50),
	@ChallengeId nvarchar(50),
	@EventId int
AS
begin
	insert into dbo.[tblTeamInChallenge] (ChallengedTeamId, ChallengerTeamId, ChallengeId, EventId)
	values (@ChallengedTeamId, @ChallengerTeamId, @ChallengeId, @EventId)
end
GO
PRINT N'Creating Procedure [dbo].[spTeamInEvent_Delete]...';


GO
CREATE PROCEDURE [dbo].[spTeamInEvent_Delete]
	@TeamId nvarchar(50)
AS
begin
	delete 
	from dbo.[tblTeamInEvent]
	where TeamId = @TeamId;
end
GO
PRINT N'Creating Procedure [dbo].[spTeamInEvent_Insert]...';


GO
CREATE PROCEDURE [dbo].[spTeamInEvent_Insert]
	@TeamId nvarchar(50),
	@EventId int
AS
begin
	insert into dbo.[tblTeamInEvent] (TeamId, EventId)
	values (@TeamId, @EventId)
end
GO
PRINT N'Creating Procedure [dbo].[spVoteOnWaiting_Delete]...';


GO
CREATE PROCEDURE [dbo].[spVoteOnWaiting_Delete]
	@Id nvarchar(50)
AS
begin
	Delete
	from dbo.[tblVoteOnWaiting]
	where TeamId = @Id;
end
GO
PRINT N'Creating Procedure [dbo].[spVoteOnWaiting_GetAll]...';


GO
CREATE PROCEDURE [dbo].[spVoteOnWaiting_GetAll]
AS
begin
	SELECT *
	from dbo.[tblVoteOnWaiting]
end
GO
PRINT N'Creating Procedure [dbo].[spVoteOnWaiting_GetVote]...';


GO
CREATE PROCEDURE [dbo].[spVoteOnWaiting_GetVote]
	@Id nvarchar(50)
AS
begin
	SELECT *
	from dbo.[tblVoteOnWaiting]
	where TeamId = @Id;
end
GO
PRINT N'Creating Procedure [dbo].[spVoteOnWaiting_Insert]...';


GO
CREATE PROCEDURE [dbo].[spVoteOnWaiting_Insert]
	@ChallengeId nvarchar(50),
	@TeamId nvarchar(50),
	@ExpiringDateForVotes date
AS
begin
	insert into dbo.[tblVoteOnWaiting] (ChallengeId, TeamId, ExpiringDateForVotes)
	values (@ChallengeId, @TeamId, @ExpiringDateForVotes)
end
GO
PRINT N'Creating Procedure [dbo].[spVoteOnWaiting_Update]...';


GO
CREATE PROCEDURE [dbo].[spVoteOnWaiting_Update]
    @ChallengeId nvarchar(50),
	@TeamId nvarchar(50),
	@ExpiringDateForVotes date
AS
begin
	update dbo.[tblVoteOnWaiting]
	set TeamId = @TeamId, ChallengeId = @ChallengeId, ExpiringDateForVotes = @ExpiringDateForVotes
	where TeamId = @TeamId;
end
GO
if not exists (select 1 from dbo.[tblTeam])
begin
	insert into dbo.[tblTeam] (ContactPhone, DateOfRegistration, IsInTop5, Lost,PasswordHash,Player1,Player2,Player3,Player4,TeamId,TeamName,Wins)
	values ('061525846', '2021-6-4', 0, NULL, 'adsa23-411', 'Mirko','Slavko','Jovan','Uros', 'dsadsa2321', 'Tim23', NULL),
	('064313245', '2021-6-4', 0, NULL, 'dasds-dsa2', 'Nemanja','Milos','Stefan','Dragan', 'dsadasd2133', 'Druzina', NULL),
	('063213134', '2021-6-7', 0, NULL, 'dsadsadg-21a', 'Steva','Marko','Jovan','Momcilo', 'gfdghfdg1321', 'Beraci Pamuka', NULL),
	('062343243', '2021-6-10', 0, NULL, 'dghtefa-23s', 'Vuk','Vlada','Zarko','Milan', 'gfdgdawer23', 'Beda iz predgradja', NULL),
	('066564452', '2021-6-6', 0, NULL, 'dasgfdgsg-das', 'Mirko','Slavko','Jovan','Uros', 'dsadf2fd3221', 'KK Mega', NULL)
	
end
GO

GO
PRINT N'Update complete.';


GO
